var story = Object()
var ref98746 = ""
story.s1 = {"lore":"You wake up in a dark room.\nYou consider how overused that introduction is.\nAfter considering for a good hour or so, you get your bearings.\nPitch dark in the left.\nPitch dark in the right.\nAnd even pitch dark in front of you.\nHow about finding a wall?","choices":[{"name":"Find a wall","link":{"lore":"You can't find a wall\nYou should probably eat your sandwich","choices":[{"name":"Eat your sandwich","link":{"lore":"%%linkto,story.s1.choices[1].link%%","choices":[]}},{"name":"No","link":{"lore":"Why not? You should always make sure to eat your sandwich.","choices":[{"name":"Eat your sandwich","link":{"lore":"%%linkto,story.s1.choices[1].link%%","choices":[]}},{"name":"NO","link":{"lore":"Are you sure? It looks like a very tasty sandwich","choices":[{"name":"Eat your sandwich","link":{"lore":"%%linkto,story.s1.choices[1].link%%","choices":[]}},{"name":"NO!","link":{"lore":"Okay, okay... No sandwich. I get the idea.\nSo what are you going to do besides not eating your sandwich?","choices":[{"name":"EAT YOUR FLIPPIN' SANDWICH","link":{"lore":"%%linkto,story.s1.choices[1].link%%","choices":[]}},{"name":"Go into the darkness","link":{"lore":"Scary. But seems legit.\nSo which darkness do you want to go into?","choices":[{"name":"Left","link":{"lore":"You go left.\nOr did you go right?\nI'm not really sure.\nYou trip over a walrus and fall into a giant pit\nThat's cool I guess\n%%lose%%","choices":[]}},{"name":"Right","link":{"lore":"You go right.\nOr did you go left?\nI'm not really sure.\nA wall greets you with a rather rude slam.\nGroping around, you find a doorknob.\nWhat do you do?","choices":[{"name":"Cry","link":{"lore":"Crying isn't going to help...","choices":[{"name":"Okay :(","link":{"lore":"%%linkto,story.s1.choices[0].link.choices[1].link.choices[1].link.choices[1].link.choices[1].link.choices[1].link%%","choices":[]}}]}},{"name":"Open the door","link":{"lore":"IN SOVIET RUSSIA, DOOR OPEN YOU!\n%%lose%%","choices":[]}},{"name":"Notice Senpai","link":{"lore":"Deciding to return the favor, you look into the corner to find...\nSENPAI :D\nThe one and only\nSo you notice Senpai\nBut...\nIN SOVIET RUSSIA... Senpai notice you?\nSenpai has noticed you.\nThe master of spacetime just acknowledged you.\nYou could do just about anything right now.\nAnything at all, with the power of Senpai.\nWell, any of the following three choices, so I guess your limited.","choices":[{"name":"Unlock universe secrets","link":{"lore":"You tell Senpai:\n\"I wish to understand the secrets of the universe\"\nIN SOVIET RUSSIA...\nUNIVERSE SECRETS UNLOCK YOU\n%%lose%%","choices":[]}},{"name":"Obtain godly powers","link":{"lore":"You tell Senpai:\n\"I wish to become one of the most powerful beings\"\nIN SOVIET RUSSIA...\nGODLY POWERS OBTAIN YOU\n%%lose%%","choices":[]}},{"name":"Improve your sandwich","link":{"lore":"You tell Senpai:\n\"I need to make my sandwich better; ham and cheese isn't enough\"\nIn a shower of sparks and swirling power you sandwich is blessed.\nIn a heavenly explosion, your are blinded.\nWhen you can see again, your eyes do not believe what they see;\nA mix of cheddar, onions, and garlic generously piled onto sourdough bread.\nThis is a beautiful sandwich.\nYou're not sure what to do.","choices":[{"name":"Eat it","link":{"lore":"This sandwich is blessed.\nYou will probably inherit its blessing by consuming it.\nEating its wonderful deliciousness, you gain heavenly powers.\nYou can now see everything.\nYou just beat the game.\nBravo.\nOf course, eating a sandwich is not the only way you can win...\n%%win%%","choices":[]}},{"name":"Worship it","link":{"lore":"Worshipping a sandwich is not a good idea...\nEspecially with Senpai around.\nSenpai uses their wrath to destroy you.\nYou see a flash of death, and then nothing...\n%%lose%%","choices":[]}}]}}]}}]}},{"name":"Forward","link":{"lore":"You head forward, and you are certain you are going forward.\nThis is because of your great logic and reasoning skills.\nActually, most people just decide they are facing forward.\nSo you do the same.\nSmart.\nAnyways...\nThis huge room is now a mess of terrible, lost creativity.\nYou fall into a pit, but oh... There are cushions at the bottom.\nWHO WOULD PUT CUSHIONS AT THE BOTTOM OF A DITCH THAT SHOULD KILL YOU?!\nI guess they don't know how this game works.\nYou land softly on the cushions into a well lit room.\nWell, I worded that weird.\nTHIS ROOM IS LIT!\nI worded that weird again.\nTHIS ROOM IS ON FIRE AND YOU SHOULD PROBABLY GET OUT OF IT UNLESS YOU WANT TO DIE!","choices":[{"name":"Go to the door","link":{"lore":"You go to the door.\nNow what?","choices":[{"name":"Grab the doorknob","link":{"lore":"Then?","choices":[{"name":"Turn slowly, clockwise","link":{"lore":"Wrong direction.","choices":[{"name":"Turn hastily, counterclockwise","link":{"lore":"AND NOW WHAT?","choices":[{"name":"Pull","link":{"lore":"Idiot. Can you read?\nIt says \"Push\" on it","choices":[{"name":"Push","link":{"lore":"YOU AREN'T HOLDING THE DOORKNOB","choices":[{"name":"Grab the doorknob, turn counterclockwise, push","link":{"lore":"Good\nBravo\nStunning performance\nOpening a door, in 6 confusing steps with you.\nI knew you could do it.\nYou could probably conquer nations with your skills","choices":[{"name":"Conquer a nation","link":{"lore":"You face off a nation, intimidating them with your skills\nYou open the doors\nThey fall\nYou are now the new, skilled, master of door opening, and the nations.\n%%win%%","choices":[]}},{"name":"Do professional door opening","link":{"lore":"You train for ten years, perfecting your talent.\nFinally, once you are ready, you go into professional door opening.\nIt pays quite well, and you become a rich fellow.\nCongrats, master door opener.\n%%win%%","choices":[]}},{"name":"Look beyond the door","link":{"lore":"You look beyond the door.\nInto the future.\nInto the rest of the dungeon.\nYou see traps of flames.\nSpikes.\nSwinging axes.\nAnd a door that says employees only.\nHuh.","choices":[{"name":"Face the traps","link":{"lore":"You get ready to bounce through the traps when an arrow hits you in the head.\nReally?\nTrying to be heroic, oh master of doors?\n%%lose%%","choices":[]}},{"name":"Go to the door, grab the doorknob, turn counterclockwise, push","link":{"lore":"Doesn't work","choices":[{"name":"Pull","link":{"lore":"You aren't holding anything","choices":[{"name":"Go to the door, grab the doorknob, turn counterclockwise, pull","link":{"lore":"You open the employee only door and look inside.\nHuh. A path to the end of the traps.\nYou calmly walk along and come out on the other side.\nTrap parkour 101 by you, oh master of opening doors.\nYou walk into a room with a huge button that says \"WIN\"","choices":[{"name":"Go and press it","link":{"lore":"You don't notice the huge ravine between you and the button.\nYou fall to your death...\n%%lose%%","choices":[]}},{"name":"Look around","link":{"lore":"There is a ravine between you and the button.\nHow do you get across?","choices":[{"name":"Mad hops","link":{"lore":"You try to jump across the five foot ravine.\nYou fall to your death...%%lose%%","choices":[]}},{"name":"Google","link":{"lore":"You google \"How to get across huge ravine and win the game\"\nWell.\nThere are three options","choices":[{"name":"Jetpack","link":{"lore":"You use a jetpack to get across.\nYour thrust to weight ratio is broken.\nYou slowly fall deep into the ravine and land softly on...\nThe sharp, sharp spikes at the bottom.\n%%lose%%","choices":[]}},{"name":"Swag","link":{"lore":"You try to look cool.\nYou dab as you jump across.\nYou fall to your death...\nAt least you looked cool trying?\n%%lose%%","choices":[]}},{"name":"Anaylsis","link":{"lore":"You look around, considering the safest way across.\nThe closest jump is a stretch of rock six inches from the other side.\nThere is also a tightrope.\nAnd a door...","choices":[{"name":"Try jumping","link":{"lore":"The rock crumbles away as you fall.\nYou trip and cry out a call.\nYour death is quick.\nThis is a limerick.\nAnd for you, that is all.\n%%lose%%","choices":[]}},{"name":"Tightrope","link":{"lore":"The tightrope wasn't tight enough.\nIt snaps and you fall to your death.\n%%lose%%","choices":[]}},{"name":"Go to door","link":{"lore":"Now what?","choices":[{"name":"Grab the doorknob, turn counterclockwise, try pushing and pulling.","link":{"lore":"Bravo, you got it in one line.\nThere is a straight path to the win button\nYOU HAVE WON!\nWait, no... not yet.\nYou still need to press it.","choices":[{"name":"Press the win button","link":{"lore":"A shower of confetti falls from the sky.\nYOU HAVE WON, O MASTER OF DOORS\n%%win%%","choices":[]}},{"name":"Eat your sandwich","link":{"lore":"%%linkto,story.s1.choices[1].link%%","choices":[]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}},{"name":"Hug the flames","link":{"lore":"Bad idea.\nVery bad idea.\nHugging dangerous fire is VERY BAD IDEA.\nI think you might be dead, because your flesh is hopelessly charred.\n%%lose%%","choices":[]}}]}}]}}]}}]}}]}}]}},{"name":"Eat your sandwich","link":{"lore":"It's only ham and cheese\nONLY HAM AND CHEESE\nYou wither up and die to to the lack of swaginess in your sandwich\n%%lose%%","choices":[]}}]}

function typeWriter(text){

}
function replaceAll(str, find, replace) {
  return str.replace(new RegExp(find, 'g'), replace);
}
function debrief(code,code1,code2){
	$("#header").html(`
    <p>
	`+replaceAll(code1,"\n","<br/>")+`
	`+replaceAll(code2,"\n","<br/>")+`
	</p>
	`)
    $("#footer").html(`<button class = "btn btn-basic" style = "width:100%;border-radius:0px" onclick = "$('#content').html(\`<div id='header'></div><hr><div id='footer'></div>\`);run('story.s1')">Try again</button>`)
}
function run(loc){
    var loc1 = loc
            var loc = eval(loc)
            var lo = checkcode(loc.lore)
			if(!lo.match(/(LINKTO|VICTORY|LOSS|ICZ)/i)){

            var info = replaceAll(lo,"\n","<br/>")
            document.getElementById("header").innerHTML = info
            document.getElementById("footer").innerHTML = ""
            var btnCode = ""
            for(i=0;i<loc.choices.length;i++){
                btnCode+= "<button class = 'btn btn-basic' onclick = \"run('"+loc1+".choices["+i+"].link')\" style = width:"+100/loc.choices.length+"%;border-radius:0px>"+loc.choices[i].name+"</button>"
            }
            $(btnCode).appendTo("#footer")
	//Deprecated restart button: document.getElementById("footer").innerHTML+='<button class = "btn btn-default" style = "width:100%;border-radius:0px" onclick = "run(\'story.s1\')">Restart</button>'
}}
function checkcode(str){
var code = /%%((?!%).)*%%/g
var fixed = str.replace(/%%((?!%).)*%%/g,"")
var matches = str.match(code)
//Handle no matches
	if(matches!=null){
	//Format each match
	for(i=0;i<matches.length;i++){
    //Split into readable arrays
		matches[i] = matches[i].substring(2,matches[i].length-2).split(",")
    //Define the amount of arguments the array has
    var l = matches[i].length
    //Handle arguments
    if(l>0){
      if(!(matches[i][1]===undefined)){
		if(matches[i][1].length>1){
        //Define lore if it exists
      	var eventLore = matches[i][1]
      }
      else if(matches[i][1].length<=1){
      }}
	  if(l>2){
      //Check to see if matches[i][2] actually exists
      if(!(matches[i][2]===null)){
      if(!matches[i][2].match(/^(null|undefined|false|empty|nothing| |)$/i)&&!matches[i][2].length<1){
    	eval(matches[i][2])
      }}}


    }
    //Handle victories with message
    function handleVictory(){
		if(fixed.length===0){debrief(ref98746,"<h3 style = 'color:#2ecc71'>VICTORY</h4>","You have succeeded at the quest \"" + ref98746 + "\".")}
        else if(fixed.length!=0){
            debrief(ref98746,"<h3 style = 'color:#2ecc71'>VICTORY</h3>",fixed)
        }
		fixed = "VICTORY"
    }
    //Handle loss with message
    function handleLoss(){
        if(fixed.length===0){debrief(ref98746,"<h3 style = 'color:#e74c3c'>FAILURE</h4>","You have failed the quest \"" + ref98746 + "\".")}
        else if(fixed.length!=0){
            debrief(ref98746,"<h3 style = 'color:#e74c3c'>FAILURE</h3>",fixed)
        }
		fixed = "LOSS"
    }
	//Handle link with redirect to part of story
	function handleLink(msg){
		run(msg)
		fixed = "LINKTO"
	}
    function handleIce(){
        if(fixed.length===0){debrief(ref98746,"<h3 style = 'color:#3498db'>BIG OL' BAG OF ICE</h4>","You have failed the quest \"" + ref98746 + "\".")}
        else if(fixed.length!=0){
            debrief(ref98746,"<h3 style = 'color:#3498db'>BIG OL' BAG OF ICE</h3>",fixed)
        }
		fixed = "ICZ"
    }
    //Handle victory with corresponding regex
    if(matches[i][0].match(/^(win|true|t|victory)$/i)){
    	handleVictory()
    }
    //Handle loss with corresponding regex
    if(matches[i][0].match(/^(lose|loss|death|defeat|false|f|failure|fail)$/i)){
    	handleLoss()
    }
    if(matches[i][0].match(/^(ice)$/i)){
		handleIce()
	}
	//Handle linkto with corresponding regex
	if(matches[i][0].match(/^(link|linkto|go|goto|redirect|redirectto|loop|loopto)$/i)){
		handleLink(eventLore)
	}
  //Code to execute, has been interpreted: matches
  //Text to show to the user, code has been hidden: fixed
}
}
return fixed}
run("story.s1")
